var K=Object.defineProperty;var A=Object.getOwnPropertySymbols;var Y=Object.prototype.hasOwnProperty,z=Object.prototype.propertyIsEnumerable;var M=(s,n,u)=>n in s?K(s,n,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[n]=u,B=(s,n)=>{for(var u in n||(n={}))Y.call(n,u)&&M(s,u,n[u]);if(A)for(var u of A(n))z.call(n,u)&&M(s,u,n[u]);return s};import{r as D,d as $,u as G,l as p,a as x,o as Q,b as W,c as y,e as C,f as m,g as o,N as _,w as E,h as T,i as S,t as L,F as P,j as X,k as V,m as O,n as Z,p as H,q as ee,s as te}from"./vendor.d2cbe314.js";const ae=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))g(r);new MutationObserver(r=>{for(const e of r)if(e.type==="childList")for(const t of e.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&g(t)}).observe(document,{childList:!0,subtree:!0});function u(r){const e={};return r.integrity&&(e.integrity=r.integrity),r.referrerpolicy&&(e.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?e.credentials="include":r.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function g(r){if(r.ep)return;r.ep=!0;const e=u(r);fetch(r.href,e)}};ae();function b(s){const n=D({value:s,onChange:u=>{n.value=u}});return n}function oe(s){return`${s.getFullYear()}/${s.getMonth()+1}/${s.getDate()} ${s.getHours()}:${s.getMinutes()}:${s.getSeconds()}`}const ne=V("OK"),se=S("p",null,"\u6D88\u606F:",-1),le=S("p",null,"\u8F93\u5165:",-1),ue=V("\u53D1\u9001"),re=$({setup(s){const n=G(),u=p.createInstance({name:"rooms"}),g=p.createInstance({name:"users"}),r=p.createInstance({name:"messages"}),e=D({id:"",name:""}),t=D({id:"",name:"",host:"",secret:""}),i=x(null),w=x([]),d=x(!1),J=()=>{i.value&&(i.value.on("connect_error",c=>{console.error(c)}),i.value.on("connect",function(){console.log(`\u94FE\u63A5\u6210\u529F ${i.value.id}`)}),i.value.on("disconnect",function(){console.log("\u79BB\u7EBF"),d.value=!1}),i.value.on("message",async c=>{switch(c.type){case"text":{const a=c,l=O.exports.AES.decrypt(a.data.text,t.secret).toString(O.exports.enc.Utf8);let v=null;try{v=JSON.parse(l),v.m!=="#thisistext#"&&(v=null)}catch(de){}if(v===null){n.error("\u89E3\u7801\u5931\u8D25");return}a.data.text=v.t,w.value.push({name:a.name,text:a.data.text,time:new Date(a.time)}),await r.setItem(new Date().getTime().toString(),{room:a.data.room,text:a.data.text,type:"text",uid:e.id,time:a.time,name:a.name,sender:a.id})}break}}),i.value.on("control",async c=>{switch(c.action){case"login_success":n.success("\u767B\u9646\u6210\u529F"),d.value=!0;break;case"enter_room":{const a=c;a.id===e.id?(t.id=a.room,t.name=a.room_name,await u.setItem(a.room+"&&"+e.id,B({uid:e.id},o(t))),await p.setItem("current_roomd",a.room)):w.value.push({name:a.name,text:"\u8FDB\u5165\u623F\u95F4",time:new Date})}break;case"exit_room":{const a=c;a.id===e.id?(t.id="",t.name=""):w.value.push({name:a.name,text:"\u79BB\u5F00\u623F\u95F4",time:new Date})}break}}))},U=x(),F=x(""),R=c=>{F.value=c},j=()=>{i.value.emit("message",{type:"text",id:e.id,name:e.name,data:{room:t.id,text:O.exports.AES.encrypt(JSON.stringify({t:F.value,m:"#thisistext#"}),t.secret).toString()}}),F.value="",setTimeout(()=>{U.value.scrollTop=U.value.scrollHeight},1)},f=b(t.host),I=b(e.id),k=b(e.name),h=b(t.id),N=b(t.secret);Q(async()=>{const c=await p.getItem("current_uid");if(c){const l=await g.getItem(c);l&&(e.id=l.id,e.name=l.name,f.value=t.host,I.value=e.id,k.value=e.name)}const a=await p.getItem("current_roomd");if(a){const l=await u.getItem(a+"&&"+e.id);l&&(t.id=l.id,t.name=l.name,t.host=l.host,f.value=t.host,h.value=l.id,t.secret=l.secret,N.value=l.secret)}});const q=async()=>{e.id=I.value,e.name=k.value,t.id=h.value,t.host=f.value,t.secret=N.value,await p.setItem("current_uid",e.id),await g.setItem(e.id,B({},o(e))),i.value=Z(f.value,{transports:["websocket"]}),J(),i.value.emit("control",{action:"connect",id:e.id,name:e.name}),i.value.emit("control",{action:"enter_room",room:h.value,id:e.id})};return W(()=>{i.value&&i.value.disconnect()}),(c,a)=>(y(),C(P,null,[m(o(_),{value:o(f).value,"onUpdate:value":o(f).onChange,placeholder:"HOST",disabled:d.value},null,8,["value","onUpdate:value","disabled"]),m(o(_),{value:o(I).value,"onUpdate:value":o(I).onChange,placeholder:"ID",disabled:d.value},null,8,["value","onUpdate:value","disabled"]),m(o(_),{value:o(k).value,"onUpdate:value":o(k).onChange,placeholder:"NAME",disabled:d.value},null,8,["value","onUpdate:value","disabled"]),m(o(_),{value:o(h).value,"onUpdate:value":o(h).onChange,placeholder:"ROOM",disabled:d.value},null,8,["value","onUpdate:value","disabled"]),m(o(_),{value:o(N).value,"onUpdate:value":o(N).onChange,placeholder:"SECRET",disabled:d.value},null,8,["value","onUpdate:value","disabled"]),m(o(T),{onClick:q,disabled:d.value},{default:E(()=>[ne]),_:1},8,["disabled"]),se,S("p",null,"Room: "+L(o(t).name===""?"\u672A\u8FDE\u63A5":o(t).name),1),S("div",{ref:(l,v)=>{v.scroll=l,U.value=l},style:{height:"200px",overflowY:"scroll"}},[(y(!0),C(P,null,X(w.value,l=>(y(),C("p",null,L(`[${o(oe)(l.time)}] [${l.name}]: ${l.text}`),1))),256))],512),le,m(o(_),{value:F.value,"onUpdate:value":R},null,8,["value"]),m(o(T),{onClick:j,disabled:!d.value},{default:E(()=>[ue]),_:1},8,["disabled"])],64))}}),ce=$({setup(s){return(n,u)=>(y(),H(re))}}),ie=$({setup(s){return(n,u)=>(y(),H(o(ee),null,{default:E(()=>[m(ce)]),_:1}))}});te(ie).mount("#app");
