var Q=Object.defineProperty;var L=Object.getOwnPropertySymbols;var W=Object.prototype.hasOwnProperty,X=Object.prototype.propertyIsEnumerable;var P=(l,n,r)=>n in l?Q(l,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[n]=r,U=(l,n)=>{for(var r in n||(n={}))W.call(n,r)&&P(l,r,n[r]);if(L)for(var r of L(n))X.call(n,r)&&P(l,r,n[r]);return l};import{r as D,d as E,u as Z,l as _,a as h,o as ee,i as V,b as te,c as b,e as C,f as p,g as o,N as g,w as O,h as H,j as N,t as J,F as R,k as ae,m as j,n as A,p as q,q as oe,s as ne}from"./vendor.02dff3a4.js";const se=function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))x(i);new MutationObserver(i=>{for(const e of i)if(e.type==="childList")for(const t of e.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&x(t)}).observe(document,{childList:!0,subtree:!0});function r(i){const e={};return i.integrity&&(e.integrity=i.integrity),i.referrerpolicy&&(e.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?e.credentials="include":i.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function x(i){if(i.ep)return;i.ep=!0;const e=r(i);fetch(i.href,e)}};se();function y(l){const n=D({value:l,onChange:r=>{n.value=r}});return n}function le(l){return`${l.getFullYear()}/${l.getMonth()+1}/${l.getDate()} ${l.getHours()}:${l.getMinutes()}:${l.getSeconds()}`}const re=j("OK"),ue=N("p",null,"\u6D88\u606F:",-1),ie=N("p",null,"\u8F93\u5165:",-1),ce=j("\u53D1\u9001"),de=E({setup(l){const n=Z(),r=_.createInstance({name:"rooms"}),x=_.createInstance({name:"users"}),i=_.createInstance({name:"messages"}),e=D({id:"",name:""}),t=D({id:"",name:"",host:"",secret:""}),u=h(null),w=h([]),m=h(!1),T=h(0),M=()=>{u.value&&(u.value.on("connect_error",s=>{console.error(s)}),u.value.on("connect",function(){console.log(`\u94FE\u63A5\u6210\u529F ${u.value.id}`)}),u.value.on("disconnect",function(){console.log("\u79BB\u7EBF"),m.value=!1,setTimeout(()=>{var s,a;(s=u.value)==null||s.emit("control",{action:"connect",id:e.id,name:e.name}),(a=u.value)==null||a.emit("control",{action:"enter_room",room:t.id,id:e.id})},1e3)}),u.value.on("message",async s=>{switch(s.type){case"text":{const a=s;if(a.data.room===t.id){const d=A.exports.AES.decrypt(a.data.text,t.secret).toString(A.exports.enc.Utf8);let v=null;try{v=JSON.parse(d),v.m!=="#thisistext#"&&(v=null)}catch(c){}if(v===null){n.error("\u89E3\u7801\u5931\u8D25");return}a.data.text=v.t,w.value.push({name:a.name,text:a.data.text,time:new Date(a.time)}),await i.setItem(new Date().getTime().toString(),{room:a.data.room,text:a.data.text,type:"text",uid:e.id,time:a.time,name:a.name,sender:a.id})}}break}}),u.value.on("control",async s=>{switch(s.action){case"login_success":n.success("\u767B\u9646\u6210\u529F"),m.value=!0;break;case"enter_room":{const a=s;a.room===t.id&&(a.id===e.id?(t.id=a.room,t.name=a.room_name,await r.setItem(a.room+"&&"+e.id,U({uid:e.id},o(t))),await _.setItem("current_roomd",a.room)):w.value.push({name:a.name,text:"\u8FDB\u5165\u623F\u95F4",time:new Date}))}break;case"exit_room":{const a=s;a.room===t.id&&(a.id===e.id?(t.id="",t.name=""):w.value.push({name:a.name,text:"\u79BB\u5F00\u623F\u95F4",time:new Date}))}break;case"resp_online_users":{const a=s;t.id===a.room&&(T.value=a.count)}break}}))},S=h(),F=h(""),K=s=>{F.value=s},Y=()=>{u.value.emit("message",{type:"text",id:e.id,name:e.name,data:{room:t.id,text:A.exports.AES.encrypt(JSON.stringify({t:F.value,m:"#thisistext#"}),t.secret).toString()}}),F.value="",setTimeout(()=>{S.value.scrollTop=S.value.scrollHeight},1)},z=setInterval(()=>{var s;e.id!=""&&t.host!=""&&t.id!=""&&m.value&&((s=u.value)==null||s.emit("control",{room:t.id,action:"ask_online_users"}))},5e3),f=y(t.host),I=y(e.id),k=y(e.name),$=y(t.id),B=y(t.secret);ee(async()=>{var d,v;const s=await _.getItem("current_uid");if(s){const c=await x.getItem(s);c&&(e.id=c.id,e.name=c.name,f.value=t.host,I.value=e.id,k.value=e.name)}const a=await _.getItem("current_roomd");if(a){const c=await r.getItem(a+"&&"+e.id);c&&(t.id=c.id,t.name=c.name,t.host=c.host,f.value=t.host,$.value=c.id,t.secret=c.secret,B.value=c.secret)}e.id!=""&&t.id!=""&&t.host!=""&&(u.value=V(f.value,{transports:["websocket"]}),M(),(d=u.value)==null||d.emit("control",{action:"connect",id:e.id,name:e.name}),(v=u.value)==null||v.emit("control",{action:"enter_room",room:t.id,id:e.id}))});const G=async()=>{e.id=I.value,e.name=k.value,t.id=$.value,t.host=f.value,t.secret=B.value,await _.setItem("current_uid",e.id),await x.setItem(e.id,U({},o(e))),u.value=V(f.value,{transports:["websocket"]}),M(),u.value.emit("control",{action:"connect",id:e.id,name:e.name}),u.value.emit("control",{action:"enter_room",room:t.id,id:e.id})};return te(()=>{u.value&&u.value.disconnect(),clearInterval(z)}),(s,a)=>(b(),C(R,null,[p(o(g),{value:o(f).value,"onUpdate:value":o(f).onChange,placeholder:"HOST",disabled:m.value},null,8,["value","onUpdate:value","disabled"]),p(o(g),{value:o(I).value,"onUpdate:value":o(I).onChange,placeholder:"ID",disabled:m.value},null,8,["value","onUpdate:value","disabled"]),p(o(g),{value:o(k).value,"onUpdate:value":o(k).onChange,placeholder:"NAME",disabled:m.value},null,8,["value","onUpdate:value","disabled"]),p(o(g),{value:o($).value,"onUpdate:value":o($).onChange,placeholder:"ROOM",disabled:m.value},null,8,["value","onUpdate:value","disabled"]),p(o(g),{value:o(B).value,"onUpdate:value":o(B).onChange,placeholder:"SECRET",disabled:m.value},null,8,["value","onUpdate:value","disabled"]),p(o(H),{onClick:G,disabled:m.value},{default:O(()=>[re]),_:1},8,["disabled"]),ue,N("p",null,"Room: "+J(`${o(t).name===""?"\u672A\u8FDE\u63A5":o(t).name} \u5728\u7EBF\uFF1A${T.value}`),1),N("div",{ref:(d,v)=>{v.scroll=d,S.value=d},style:{height:"200px",overflowY:"scroll"}},[(b(!0),C(R,null,ae(w.value,d=>(b(),C("p",null,J(`[${o(le)(d.time)}] [${d.name}]: ${d.text}`),1))),256))],512),ie,p(o(g),{value:F.value,"onUpdate:value":K},null,8,["value"]),p(o(H),{onClick:Y,disabled:!m.value},{default:O(()=>[ce]),_:1},8,["disabled"])],64))}}),me=E({setup(l){return(n,r)=>(b(),q(de))}}),ve=E({setup(l){return(n,r)=>(b(),q(o(oe),null,{default:O(()=>[p(me)]),_:1}))}});ne(ve).mount("#app");
